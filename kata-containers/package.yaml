name: kata-containers
description: Kata Containers is an open source project and community working to build a standard implementation of lightweight Virtual Machines (VMs) that feel and perform like containers, but provide the workload isolation and security advantages of VMs
repo: kata-containers/runtime
version:
  latest: 1.11.4 # renovate: datasource=github-releases depName=kata-containers/runtime
  command: kata-runtime --version
  filter: ^kata-runtime
  pattern: s/^kata-runtime\s+:\s(.+)$/\1/
tags:
  - container
  - runtime
  - security
install:
  script: |-
    github_get_release kata-containers/runtime | \
        github_resolve_assets | \
        github_select_asset_by_suffix -x86_64.tar.xz | \
        github_get_asset_download_url | \
        download_file | \
        ${SUDO} tar -xJC "${TARGET_BASE}" --strip-components=3

    ${SUDO} mkdir -p /etc/docker
    if ! test -f /etc/docker/daemon.json; then
        echo "{}" | ${SUDO} tee /etc/docker/daemon.json >/dev/null
    fi

    ${SUDO} mv /etc/docker/daemon.json /etc/docker/daemon.json.bak
    jq --arg bin "${TARGET_BIN}" '. * {"runtimes": {"kata-runtime": {"path": ($bin + "/kata-runtime")}}}' /etc/docker/daemon.json.bak | \
        ${SUDO} tee /etc/docker/daemon.json >/dev/null
